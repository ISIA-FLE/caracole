{% extends 'layout.html' %}
{% load static %}

{% block head %}

<!-- needed by bootstrap select, has to be loaded before bootstrap -->
<script src="{% static 'tinymce/tinymce.min.js' %}"></script>
<script src="{% static 'tinymce/jquery.tinymce.min.js' %}"></script>

<script type='text/javascript' src="{% static 'edit_delivery_products.js' %}"></script>

<style type="text/css">
  /* from raf */
  #products-table {
    width: 100%;
  }

  #products-table td,
  #products-table th {
    border: none;
  }

  #products-table .row-produit {
    border-top: 1px solid #733A00;
  }

  #products-table th {
    font-family: 'oswald', sans-serif;
    text-align: center;
    color: #733A00;
    min-width: 20%;
  }

  #products-table td {
    text-align: center;
  }

  #products-table tr.texte-produit td {
    text-align: left;
    padding: 0 2rem 2rem;
  }

  .quantity input[type="number"],
  .quantity input[type="number"]:focus {
    height: auto;
    padding: .6rem 0 0 0;
    color: #ED5C01;
    border: none !important;
    box-shadow: none;
    box-sizing: border-box;
    background-color: transparent;
    font-family: 'oswald', sans-serif;
  }

  #limiteCommande label,
  #limiteCommande input {
    margin-left: 1rem;
  }

  #products-table th,
  #products-table td {
    padding: 1rem .5rem;
  }

  #products-table .name {
    width: 40%;
  }

  #products-table .price,
  #products-table .unit {
    width: 48px;
  }

  #products-table .devise {
    width: 20px;
  }

  #products-table .quantity_per_package input,
  #products-table .quantity_limit input,
  #products-table .quantum input,
  #products-table .unit_weight input {
    width: 48px;
  }

  #products-table input {
    margin: 3px;
  }

  #products-table td.unit-label {
    padding-left: 0px;
  }

  #products-table td.quantity_limit,
  #products-table td.quantity_limit input,
  #products-table td.quantum,
  #products-table td.quantum input {
    padding-right: 0px;
    margin-right: 0px;
  }


  label {
    position: relative;
  }

  label span {
    position: absolute;
    top: -3px;
    right: 10px;
    color: #000;
  }

  /* end raf */

  td.place {
    white-space: nowrap;
  }

  td.place button {
    min-width: unset;
    width: unset;
  }

  td.place button:disabled {
    color: lightgray;
  }

  td.unit input {
    width: 50px;
  }

  td.unit-label {
    text-align: left;
  }

  td.price input {
    width: 60px;
    text-align: right;
  }

  td.quantity_per_package input {
    width: 45px;
    text-align: right;
  }

  .quota,
  .quantity_per_package {
    padding-left: 10px;
  }

  td.quota input {
    width: 75px;
  }

  td.quantum input {
    width: 75px;
  }

  td.quantity_limit input {
    width: 75px;
  }

  td.unit_weight input {
    width: 75px;
    text-align: right;
  }

  td.pd-description {
    text-align: left;
  }

  tr.deleted,
  tr.deleted input,
  tr.deleted textarea {
    text-decoration: line-through;
    color: gray !important;
  }

  tr.deleted td.deleted label,
  tr.deleted td.described label {
    /* Also override hover, for 'deleted' and 'described' => important. */
    background-color: gray !important;
  }

  td.deleted label,
  td.described label {
    /* Remove extra space left and right of buttons. */
    min-width: unset;
    width: unset;
  }

  td.deleted label::before {
    content: "Effacer";
  }

  tr.deleted td.deleted label::before {
    content: "Rajouter";
  }


  #products-table th.non-rotate {
    vertical-align: bottom;
    text-align: center
  }

  #products-table textarea {
    width: 100%;
  }

  #products-table input {
    padding: 5px;
  }

  table .hidden {
    display: none;
  }

  td.place button {
    padding: 1px;
  }

  #dv-table th {
    text-align: right;
  }

  #dv-table td input {
    width: 100%;
  }

  #dv-table td select {
    width: 100%;
  }

  #dv-description {
    width: 100%;
    height: 150px;
  }

  td.image-upload input {
    display: none;
  }

  .image-upload label {
    margin: 1px;
  }

  .image-upload img {
    width: 25px;
    height: 25px;
    transition: transform 0.1s;
    object-fit: cover;
  }

  .image-upload img:hover {
    transform: scale(10);
    border: 1px solid #811305;
    box-shadow: 1px 0.5px 0.5px black;
    cursor: pointer;
  }
</style>
{% endblock %}

{% block content %}
<section class="container margetopXl margebot">
  <h1>Modifier la commande</h1>
  <form method="post" action="" enctype="multipart/form-data" id="form">

    <div class="container">
    <div class="row align-item-start">
      <div class="col-xs-4">
        <table id="dv-table">
          <tr>
            <th><label for="dv-name">Nom de la commande :</label></th>
            <td><input id="dv-name" maxlength="64" name="dv-name" type="text" value="" required /></td>
          </tr>
          <tr>
            <th><label for="dv-state">État de la commande :</label></th>
            <td>
              <select id="dv-state" name="dv-state">
                {% for key, name in delivery.STATE_CHOICES.items %}
                <option value="{{key}}">{{name}}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
          <tr>
            <th><label for="producer">Producteur :</label></th>
            <td><select id="producer" name="producer" onchange="reflect_producer_selection()"></select></td>
          </tr>
          <tr>
            <th><label for="freeze-date">Commander avant :</label></th>
            <td><input type="date" id="freeze-date" name="freeze-date"></td>
          </tr>
          <tr>
            <th><label for="distribution-date">Jour de commande :</label></th>
            <td><input type="date" id="distribution-date" name="distribution-date"></td>
          </tr>
        </table>
      </div>

      <div class="col-xs-8">
        <h3>Description de la commande</h3>
        <div class="when-some-producer">
          <p>Vous avez renseigné un producteur pour cette commande, <br/>
            c'est la description standard de ce producteur qui sera affichée.<br/>
          <a id="edit-producer" href="{% url 'edit_user_description' user=9999 %}?">Éditer la présentation du producteur</a>.
        </p></div>
        <div class="when-no-producer">
          <textarea name="dv-description" id="dv-description" rows="10"></textarea>
        </div>
      </div>
    </div>
    </div>

    <h3>Produits proposés</h3>
    <table id="products-table">
      <thead>
        <tr>
          <th class="hidden"></th>
          <th class="">#</th>
          <th class="">Produit</th>
          <th class="">Prix</th>
          <th class=""></th>
          <th class="">Unité</th>
          {# <th colspan="2" class="qpp">Par carton</th> #}
          <th colspan="2" class="quota">Quota</th>
          <th colspan="2" class="">Quantum</th>
          {#<th colspan="2" class="">Poids</th>#}
          <th class="">Image</th>
          <th>
          </th>
          <th>
          </th>
        </tr>
        <tr>
          <td>&nbsp;</td>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p>
      <button type='button' onclick="add_blank_products();">Ajouter des produits</button>
      <button type="button" onclick="submit_if_valid(false);">Sauver &amp; continuer</button>
      <button type="button" onclick="submit_if_valid(true);">Sauver &amp; quitter</button>
      <input type='hidden' name='dv-id' id='dv-id' value='' />
      <input type='hidden' name='n_rows' id="n_rows" value='0' />
      <input type='hidden' name='then_leave' id="then_leave" value='' />
      {% csrf_token %}
    </p>
  </form>
</section>
{% endblock %}